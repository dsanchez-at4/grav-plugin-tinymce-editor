tinymce.PluginManager.add('responsiveimage', function(editor,url){
	editor.addButton('responsiveimage',{
		text: 'Responsive image',
		icon: false,
		onclick: function() {
		      // Open window
		      editor.windowManager.open({
		        title: 'Responsive image',
		        body: [
		          {type: 'textbox', name: 'desktop', label: 'Desktop'},
		          {type: 'textbox', name: 'mobile', label: 'Mobile'},
		          {type: 'textbox', name: 'alt', label: 'Image description'}
		        ],
		        onsubmit: function(e) {

		        	if( e.data.mobile == "" || e.data.desktop == "" ){
		        		alert("You must specify both desktop and mobile versions");
		        	}else{		        	
			            // Insert content when the window form is submitted		          
			            editor.insertContent('<picture><source srcset="' + e.data.mobile + '" media="(max-width: 500px)" /><source srcset="' + e.data.desktop +'" media="(max-width: 900px)" /><img src="'+ e.data.desktop +'" alt="'+ e.data.alt +'" />');
		        	}
		          /*
					<picture>
					    <source srcset="<?php echo $about_headerimage_mobile;?>" media="(max-width: 500px)">
					    <source srcset="<?php echo $about_headerimage;?>" media="(max-width: 900px)">
					    <img srcset="<?php echo $about_headerimage;?>" alt="<?php echo $about_title;?>">
					</picture>
		          */
		        }
		      });
		    }
		  });

	// Adds a menu item to the tools menu
	/*editor.addMenuItem('responsiveimage', {
	   text: 'Responsive image',
	   context: 'tools',
	   onclick: function() {
	     // Open window with a specific url
	     editor.windowManager.open({
	       title: 'TinyMCE site',
	       url: 'https://www.tinymce.com',
	       width: 800,
	       height: 600,
	       buttons: [{
	         text: 'Close',
	         onclick: 'close'
	       }]
	     });
	   }
	});*/

	return{
		getMetadata: function(){
			return{
				name: "Responsive image plugin"
			};
		}
	};
});